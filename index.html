<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>積分小テスト作成システム</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: transparent;
        }
        header {
            text-align: center;
            margin-bottom: 40px;
        }
        h1 {
            color: #111827;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        p.desc {
            color: #4b5563;
        }
        
        /* ボタンのデザイン */
        .btn-generate {
            display: block;
            width: 100%;
            max-width: 300px;
            margin: 0 auto 40px auto;
            background-color: #2563eb; /* 青色 */
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.1s, background-color 0.2s;
        }
        .btn-generate:hover {
            background-color: #1d4ed8;
            transform: scale(1.02);
        }
        .btn-generate:active {
            transform: scale(0.98);
        }

        /* 問題カードのデザイン */
        .problem-card {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
            display: flex;
            align-items: flex-start;
        }
        .problem-number {
            font-weight: bold;
            color: #2563eb;
            font-size: 1.2rem;
            margin-right: 15px;
            min-width: 30px;
        }
        .problem-content {
            width: 100%;
        }
        .question-text {
            font-size: 1.1rem;
            margin-bottom: 10px;
            overflow-x: auto;
        }
        /* 出典テキストのデザイン */
        .source-text {
            font-size: 0.85rem;
            color: #9ca3af; /* 薄いグレー */
            text-align: right;
            margin-top: 10px; /* 上に少し隙間を空ける */
            font-style: italic;
            border-top: 1px dashed #e5e7eb; /* 点線で区切る */
            padding-top: 5px;
        }

        /* 解答エリアのデザイン */
        .answer-container {
            margin-top: 10px;
            padding-top: 15px;
            border-top: 2px solid #f3f4f6;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .answer-label {
            font-weight: bold;
            color: #059669; /* 緑色 */
            margin-bottom: 5px;
        }
        
        /* 解答表示ボタン */
        .toggle-answer-btn {
            background: none;
            border: none;
            color: #3b82f6;
            cursor: pointer;
            font-size: 0.95rem;
            padding: 5px 0;
            text-decoration: underline;
            margin-top: 5px;
        }
        .toggle-answer-btn:hover {
            color: #1d4ed8;
        }

        /* 数式のはみ出し防止 */
        mjx-container {
            overflow-x: auto;
            overflow-y: hidden;
            max-width: 100%;
        }
    </style>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>

    <div class="container">
        <header>
            <h1>積分小テスト作成システム</h1>
            <p class="desc">下のボタンを押すと、登録された問題からランダムに10問のテストを作成します。</p>
        </header>

        <button id="generate-quiz-btn" class="btn-generate">テストを作成</button>

        <div id="quiz-container">
            <!-- ここに問題が生成されます -->
        </div>
    </div>

    <script>
        // --- 問題データ ---
        // ★★★ ここにご自身の80問のデータを上書きしてください ★★★
        const allProblems = [
            // 例題1
            {q: '$\\int \\frac{(x-1)^2}{x^3} dx$', a: '$\\log|x| + \\frac{2}{x} - \\frac{1}{2x^2} + C$', source: '例題1 (1) より'},
            {q: '$\\int \\frac{x^2+2x+3}{x} dx$', a: '$\\frac{2}{5}x^{\\frac{5}{2}} + \\frac{4}{3}x^{\\frac{3}{2}} + 6x^{\\frac{1}{2}} + C$', source: '例題1 (2) より'},
            {q: '$\\int 3^x dx$', a: '$\\frac{3^x}{\\log 3} + C$', source: '例題1 (3) より'},
            {q: '$\\int \\tan^2 x dx$', a: '$\\frac{1}{3}\\tan^3 x + C$', source: '例題1 (4) より'},
            // 例題2
            {q: '$\\int \\frac{2x}{x^2+3} dx$', a: '$\\log(x^2+3) + C$', source: '例題2 (1) より'},
            {q: '$\\int 2x(x^2+5)^7 dx$', a: '$\\frac{1}{8}(x^2+5)^8 + C$', source: '例題2 (2) より'},
            {q: '$\\int \\sin^3 x \\cos x dx$', a: '$\\frac{1}{4}\\sin^4 x + C$', source: '例題2 (3) より'},
            {q: '$\\int x^2(x^3+4)^5 dx$', a: '$\\frac{1}{18}(x^3+4)^6 + C$', source: '例題2 (4) より'},
            // 例題3
            {q: '$\\int x e^x dx$', a: '$xe^x - e^x + C$', source: '例題3 (1) より'},
            {q: '$\\int_{0}^{\\frac{\\pi}{2}} x \\cos x dx$', a: '$\\frac{\\pi}{2} - 1$', source: '例題3 (2) より'},
            {q: '$\\int \\log x dx$', a: '$x \\log x - x + C$', source: '例題3 (3) より'},
            {q: '$\\int x(\\log x)^2 dx$', a: '$\\frac{1}{2}x^2(\\log x)^2 - \\frac{1}{2}x^2\\log x + \\frac{1}{4}x^2 + C$', source: '例題3 (4) より'},
            {q: '$\\int e^x \\cos x dx$', a: '$\\frac{1}{2}e^x(\\sin x + \\cos x) + C$', source: '例題3 (5) より'},
            // 例題4
            {q: '$\\int_{e}^{e^e} \\frac{\\log(\\log x)}{x \\log x} dx$', a: '$\\frac{1}{2}$', source: '例題4 (1) より'},
            {q: '$\\int x^3 e^{x^2} dx$', a: '$\\frac{1}{2}e^{x^2}(x^2-1) + C$', source: '例題4 (2) より'},
            {q: '$\\int_{0}^{2} \\sqrt{4-x^2} dx$', a: '$\\pi$', source: '例題4 (3) より'},
            {q: '$\\int_{0}^{2} \\frac{1}{x^2+4} dx$', a: '$\\frac{\\pi}{8}$', source: '例題4 (4) より'},
            // 例題5
            {q: '$\\int_{-\\pi}^{\\pi} x \\cos x dx$', a: '$0$', source: '例題5 (1) より'},
            {q: '$\\int_{-\\frac{\\pi}{2}}^{\\frac{\\pi}{2}} x \\sin x dx$', a: '$2$', source: '例題5 (2) より'},
            // 例題6
            {q: '$\\int \\frac{x^2}{2-x} dx$', a: '$-\\frac{1}{2}x^2 - 2x - 4\\log|2-x| + C$', source: '例題6 (1) より'},
            {q: '$\\int \\frac{9x^2}{x^3+8} dx$', a: '$3\\log|x^3+8| + C$', source: '例題6 (2) より'},
            {q: '$\\int \\frac{dx}{x^2(x+3)}$', a: '$\\frac{1}{9}\\log|\\frac{x+3}{x}| - \\frac{1}{3x} + C$', source: '例題6 (3) より'},
            {q: '$\\int \\frac{2x+5}{x^2+4x+3} dx$', a: '$\\log|x^2+4x+3| + \\frac{1}{2}\\log|\\frac{x+1}{x+3}| + C$', source: '例題6 (4) より'},
            {q: '$\\int \\frac{3x^2+1}{x(x-1)^3} dx$', a: '$-\\log|x| + \\log|x-1| - \\frac{2}{x-1} - \\frac{2}{(x-1)^2} + C$', source: '例題6 (5) より'},
            {q: '$\\int_{0}^{\\frac{1}{2}} \\frac{1}{1+4x^2} dx$', a: '$\\frac{\\pi}{8}$', source: '例題6 (6) より'},
            {q: '$\\int_{0}^{1} \\frac{dx}{x^2-x+1}$', a: '$\\frac{2\\sqrt{3}}{9}\\pi$', source: '例題6 (7) より'},
            {q: '$\\int_{0}^{1} \\frac{1-x}{(1+x^2)^2} dx$', a: '$\\frac{\\pi}{8}$', source: '例題6 (8) より'},
            // 例題7
            {q: '$\\int \\frac{1}{\\sqrt{3x+4}} dx$', a: '$\\frac{2}{3}\\sqrt{3x+4} + C$', source: '例題7 (1) より'},
            {q: '$\\int (2x\\sqrt{x} + \\frac{1}{x\\sqrt{x}}) dx$', a: '$\\frac{4}{5}x^{\\frac{5}{2}} - 2x^{-\\frac{1}{2}} + C$', source: '例題7 (2) より'},
            {q: '$\\int \\frac{x}{\\sqrt{x+1}+1} dx$', a: '$\\frac{2}{3}(x+1)^{\\frac{3}{2}} - x + C$', source: '例題7 (3) より'},
            {q: '$\\int_{1}^{4} \\frac{1}{\\sqrt{3-\\sqrt{x}}} dx$', a: '$\\frac{4}{3}(7\\sqrt{2}-8)$', source: '例題7 (4) より'},
            // 例題8
            {q: '$\\int 3x\\sqrt{1+x^2} dx$', a: '$(1+x^2)^{\\frac{3}{2}} + C$', source: '例題8 (1) より'},
            {q: '$\\int_{0}^{13} \\frac{3}{\\sqrt[3]{(2x+1)^5}} dx$', a: '$\\frac{2}{3}$', source: '例題8 (2) より'},
            {q: '$\\int_{0}^{\\sqrt{2}} \\sqrt{x^2+4} dx$', a: '$\\frac{1}{2}\\left(\\log\\left(\\frac{1+\\frac{1}{\\sqrt{2}}}{1-\\frac{1}{\\sqrt{2}}}\\right) + 2\\sqrt{2}\\right)$', source: '例題8 (3) より'},
            {q: '$\\int_{0}^{\\frac{1}{2\\sqrt{5}}} \\frac{1}{\\sqrt{1-5x^2}} dx$', a: '$\\frac{\\pi}{6\\sqrt{5}}$', source: '例題8 (4) より'},
            {q: '$\\int_{0}^{4} \\sqrt{8x-x^2} dx$', a: '$4\\pi$', source: '例題8 (5) より'},
            {q: '$\\int \\frac{1}{\\sqrt{x^2-5}} dx$', a: '$\\log|x+\\sqrt{x^2-5}| + C$', source: '例題8 (6) より'},
            {q: '$\\int \\frac{1}{\\sqrt{2x^2-3}} dx$', a: '$2\\sqrt{2}\\log\\left|x+\\sqrt{x^2-\\frac{3}{2}}\\right|+C$', source: '例題8 (7) より'},
            {q: '$\\int \\frac{1}{\\sqrt{4x^2-3x+1}} dx$', a: '$\\frac{1}{2}\\log|x-\\frac{3}{8} + \\sqrt{x^2 - \\frac{3}{4}x + \\frac{1}{4}}| + C$', source: '例題8 (8) より'},
            {q: '$\\int_{0}^{a} \\frac{1}{a+\\sqrt{a^2-x^2}} dx$', a: '$\\frac{\\pi}{2}-1$', source: '例題8 (9) より'},
            {q: '$\\int_{0}^{1} x^2\\sqrt{1-x^2} dx$', a: '$\\frac{\\pi}{16}$', source: '例題8 (10) より'},
            {q: '$\\int_{-\\frac{1}{\\sqrt{3}}}^{\\frac{1}{\\sqrt{3}}} \\frac{1}{(1-x^2)\\sqrt{1+x^2}} dx$', a: '$-\\sqrt{2}\\log(\\sqrt{2}-1)$', source: '例題8 (11) より'},
            {q: '$\\int_{-\\frac{1}{2}}^{\\frac{1}{4}} \\frac{1}{\\sqrt{(2-x-x^2)^3}} dx$', a: '$\\frac{4\\sqrt{3}}{27}$', source: '例題8 (12) より'},
            // 例題9
            {q: '$\\int \\sin^2 x \\cos^2 x dx$', a: '$\\frac{1}{8}x - \\frac{1}{32}\\sin(4x) + C$', source: '例題9 (1) より'},
            {q: '$\\int \\sin(3x) \\cos(5x) dx$', a: '$-\\frac{1}{16}\\cos(8x) + \\frac{1}{4}\\cos(2x) + C$', source: '例題9 (2) より'},
            {q: '$\\int \\sin(2x)\\cos(2x)\\cos(4x) dx$', a: '$-\\frac{1}{32}\\cos(8x) + C$', source: '例題9 (3) より'},
            {q: '$\\int \\sin(2x) \\sin^3 x dx$', a: '$\\frac{2}{5}\\sin^5 x + C$', source: '例題9 (4) より'},
            {q: '$\\int \\frac{1}{\\tan^2(2x)} dx$', a: '$-\\frac{1}{2\\tan(2x)} - x + C$', source: '例題9 (5) より'},
            {q: '$\\int_{0}^{\\frac{\\pi}{2}} \\frac{\\sin(2x)}{2+\\sin^2 x} dx$', a: '$\\log(\\frac{3}{2})$', source: '例題9 (6) より'},
            {q: '$\\int \\frac{5}{3\\sin x+4\\cos x} dx$', a: '$\\log|\\frac{2\\tan(x/2)+1}{\\tan(x/2)-2}| + C$', source: '例題9 (7) より'},
            {q: '$\\int_{0}^{\\frac{\\pi}{2}} \\frac{1}{1+\\sin x + \\cos x} dx$', a: '$\\log 2$', source: '例題9 (8) より'},
            {q: '$\\int_{0}^{\\frac{\\pi}{2}} \\frac{\\sin^3 x}{\\sin x + \\cos x} dx$', a: '$\\frac{\\pi-1}{2}$', source: '例題9 (9) より'},
            {q: '$\\int_{0}^{\\frac{\\pi}{4}} \\log(1+\\tan x) dx$', a: '$\\frac{\\pi}{8}\\log 2$', source: '例題9 (10) より'},
            {q: '$\\int_{0}^{\\pi} \\sin(mx) \\cos(nx) dx  (m,n:自然数)$', a: '$m≠n$でm+nが奇数なら$\\frac{2m}{m^2-n^2}$, m≠nかつm+nが偶数のとき、またm=nのとき、は0', source: '例題9 (11) より'},
            {q: '$\\int_{0}^{\\pi} |3\\cos(2x)+7\\cos x| dx$', a: '$\\frac{32\\sqrt{2}}{3}$', source: '例題9 (12) より'},
            // 例題10
            {q: '$\\int x^2 \\sin(2x) dx$', a: '$-\\frac{1}{2}x^2\\cos(2x) + \\frac{1}{2}x\\sin(2x) + \\frac{1}{4}\\cos(2x) + C$', source: '例題10 (1) より'},
            {q: '$\\int (x^3-x)e^{-3x} dx$', a: '$-\\frac{e^{-3x}}{27}(9x^3+9x^2-3x+1) + C$', source: '例題10 (2) より'},
            {q: '$\\int_{0}^{\\frac{\\pi}{4}} \\frac{x}{\\cos^2 x} dx$', a: '$\\frac{\\pi}{4} - \\frac{1}{2}\\log 2$', source: '例題10 (3) より'},
            // 例題11
            {q: '$\\int 2^{x-3} dx$', a: '$\\frac{2^{x-3}}{\\log 2} + C$', source: '例題11 (1) より'},
            {q: '$\\int 3^{1-2x} dx$', a: '$-\\frac{3^{1-2x}}{2\\log 3} + C$', source: '例題11 (2) より'},
            {q: '$\\int_{2}^{4} \\log_2 x dx$', a: '$6 - \\frac{2}{\\log 2}$', source: '例題11 (3) より'},
            {q: '$\\int (x+1)e^{-3x} dx$', a: '$-\\frac{1}{3}(x+1)e^{-3x} - \\frac{1}{9}e^{-3x} + C$', source: '例題11 (4) より'},
            {q: '$\\int x^3 \\log x dx$', a: '$\\frac{1}{4}x^4 \\log x - \\frac{1}{16}x^4 + C$', source: '例題11 (5) より'},
            {q: '$\\int \\frac{e^x - e^{-x}}{e^x + e^{-x}} dx$', a: '$\\log(e^x + e^{-x}) + C$', source: '例題11 (6) より'},
            {q: '$\\int_{0}^{1} \\frac{1}{1+e^x} dx$', a: '$\\log(\\frac{2e}{1+e})$', source: '例題11 (7) より'},
            {q: '$\\int \\frac{\\sqrt{1+\\log x}}{x} dx$', a: '$\\frac{2}{3}(1+\\log x)^{\\frac{3}{2}} + C$', source: '例題11 (8) より'},
            {q: '$\\int \\frac{\\log x}{(x+1)^2} dx$', a: '$-\\frac{1}{x+1}\\log x + \\log|\\frac{x}{x+1}| + C$', source: '例題11 (9) より'},
            {q: '$\\int \\frac{\\log(\\log x)}{x} dx$', a: '$\\log x \\cdot \\log(\\log x) - \\log x + C$', source: '例題11 (10) より'},
            {q: '$\\int (\\frac{\\log x}{x})^2 dx$', a: '$-\\frac{1}{x}(\\log x)^2 - \\frac{2}{x}\\log x - \\frac{2}{x} + C$', source: '例題11 (11) より'},
            {q: '$\\int_{4}^{16} \\sqrt{x} e^{-\\sqrt{x}} dx$', a: '$20e^{-2} - 52e^{-4}$', source: '例題11 (12) より'},
            {q: '$\\int 5^{\\log x} dx$', a: '$\\frac{(5e)^{\\log x}}{\\log(5e)} + C$', source: '例題11 (13) より'},
            {q: '$\\int_{0}^{1} \\frac{1}{2+3e^x+e^{3x}} dx$', a: '$\\frac{1}{2}\\log\\left(\\frac{4e(e+2)}{3(e+1)^2}\\right)$', source: '例題11 (14) より'},
            // 例題12
            {q: '$\\int x^2(x+3) dx$', a: '$\\frac{1}{4}x^4 + x^3 + C$', source: '例題12 (1) より'},
            {q: '$\\int_{-1}^{1} \\frac{x+1}{x^2+1} dx$', a: '$\\frac{\\pi}{2}$', source: '例題12 (2) より'},
            {q: '$\\int_{-3}^{3} x(x+\\cos^3 x) dx$', a: '$18$', source: '例題12 (3) より'},
            {q: '$\\int_{-1}^{1} x(x+e^x+e^{-x}) dx$', a: '$\\frac{2}{3}$', source: '例題12 (4) より'}
        ];

        const generateQuizBtn = document.getElementById('generate-quiz-btn');
        const quizContainer = document.getElementById('quiz-container');

        generateQuizBtn.addEventListener('click', generateQuiz);

        function shuffleArray(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex !== 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [
                    array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        function generateQuiz() {
            quizContainer.innerHTML = '<div style="text-align:center; color:#666;">問題を作成中...</div>';

            if (allProblems.length < 1) {
                 quizContainer.innerHTML = '<div style="text-align:center; color:red; font-weight:bold;">エラー: 問題データがありません。<br>コード内の allProblems 配列を確認してください。</div>';
                 return;
            }

            const problemCount = Math.min(allProblems.length, 10);
            const shuffledProblems = shuffleArray([...allProblems]);
            const selectedProblems = shuffledProblems.slice(0, problemCount);

            quizContainer.innerHTML = ''; // クリア

            selectedProblems.forEach((problem, index) => {
                // ユニークなIDを生成
                const answerBoxId = `answer-box-${index}`;
                const btnId = `btn-${index}`;

                // 出典データのチェック
                // sourceがあればHTMLを作成、なければ空文字
                const sourceHtml = problem.source 
                    ? `<div class="source-text">出典: ${problem.source}</div>` 
                    : '';

                const card = document.createElement('div');
                card.className = 'problem-card';
                
                card.innerHTML = `
                    <div class="problem-number">${index + 1}.</div>
                    <div class="problem-content">
                        <div class="question-text">${problem.q}</div>
                        
                        <!-- 解答エリア -->
                        <div id="${answerBoxId}" class="answer-container" style="display: none;">
                            <div class="answer-label">解答:</div>
                            <div class="answer-text">${problem.a}</div>
                            
                            <!-- ★出典をここに移動しました -->
                            ${sourceHtml}
                        </div>

                        <!-- ボタン -->
                        <button id="${btnId}" class="toggle-answer-btn" data-target="${answerBoxId}">解答を表示</button>
                    </div>
                `;
                quizContainer.appendChild(card);
            });

            // MathJax再描画
            if (window.MathJax) {
                try {
                    if (typeof MathJax.typesetPromise === 'function') {
                        MathJax.typesetPromise([quizContainer]).catch(err => console.log(err));
                    } else if (typeof MathJax.typeset === 'function') {
                        MathJax.typeset([quizContainer]);
                    }
                } catch (e) { console.error(e); }
            }

            // ボタンのイベント設定
            document.querySelectorAll('.toggle-answer-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    const targetElement = document.getElementById(targetId);
                    
                    if (targetElement) {
                        if (targetElement.style.display === 'none') {
                            targetElement.style.display = 'block';
                            this.textContent = '解答を隠す';
                        } else {
                            targetElement.style.display = 'none';
                            this.textContent = '解答を表示';
                        }
                    }
                });
            });
        }

        // 初期表示
        generateQuiz();
    </script>
</body>
</html>
```